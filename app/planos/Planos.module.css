"use client";

import { useSearchParams } from "next/navigation";
import Link from "next/link";
import { Suspense } from "react"; 
import styles from "./Planos.module.css";

// Listas de recursos
const basic = [
  "Acesso a conte√∫dos essenciais",
  "P√°ginas de Caminh√µes, Treinamentos e Pneus",
  "Fichas t√©cnicas b√°sicas",
  "Suporte b√°sico",
];

const pro = [
  "Acesso TOTAL √† plataforma",
  "Fichas t√©cnicas completas",
  "Treinamentos avan√ßados e manuais",
  "Checklists e guias pr√°ticos",
  "Suporte t√©cnico com IA",
];

const premium = [
  "Tudo do PRO",
  "Acesso priorit√°rio a lan√ßamentos",
  "Treinamento IA personalizado",
  "Consultoria t√©cnica direta",
  "Suporte priorit√°rio",
];

const compare = [
  { label: "P√°gina de Caminh√µes e Pneus", basic: true, pro: true, premium: true },
  { label: "Treinamentos Essenciais", basic: true, pro: true, premium: true },
  { label: "Conte√∫dos Avan√ßados (Manuais)", basic: false, pro: true, premium: true },
  { label: "Suporte com IA", basic: false, pro: true, premium: true },
  { label: "Prioridade e benef√≠cios extras", basic: false, pro: false, premium: true },
];

function Check({ ok }: { ok: boolean }) {
  return (
    <span
      aria-label={ok ? "Inclu√≠do" : "N√£o inclu√≠do"}
      className={ok ? styles.ok : styles.no}
    >
      {ok ? "‚úì" : "‚Äî"}
    </span>
  );
}

function PlanosContent() {
  const searchParams = useSearchParams();
  const reason = searchParams.get("reason");

  return (
    <>
      {/* MENSAGEM DE ALERTA DO MIDDLEWARE */}
      {reason === "upgrade" && (
        <div className="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-xl text-blue-800 text-center animate-pulse">
          <p className="font-bold text-lg">üîí Conte√∫do Exclusivo</p>
          <p className="text-sm">Seu plano atual n√£o permite acessar esta p√°gina. Escolha o <b>PRO</b> ou <b>Premium</b> para liberar agora!</p>
        </div>
      )}

      {reason === "paywall" && (
        <div className="mb-8 p-4 bg-orange-50 border border-orange-200 rounded-xl text-orange-800 text-center">
          <p className="font-bold text-lg">Sua assinatura expirou ou n√£o foi encontrada</p>
          <p className="text-sm">Renove seu acesso abaixo para continuar utilizando as ferramentas.</p>
        </div>
      )}

      {/* HERO / HEADLINE */}
      <header className={styles.hero}>
        <h1 className="text-center text-4xl md:text-5xl font-extrabold tracking-tight">
          Desbloqueie o melhor da OTIAdriver
        </h1>
        <p className="mt-3 text-center text-base md:text-xl text-slate-600">
          Evolua com conte√∫do profissional para motoristas: tecnologia, seguran√ßa,
          efici√™ncia e ferramentas pr√°ticas.
        </p>
        <div className={styles.heroCtas}>
          <Link href="/checkout/pro" className={styles.heroPrimaryCta}>
            Assinar PRO (Recomendado)
          </Link>
        </div>
        <div className={styles.trustRow} aria-label="Informa√ß√µes de confian√ßa">
          <span className={styles.trustPill}>Login por SMS</span>
          <span className={styles.trustPill}>Pagamento seguro</span>
          <span className={styles.trustPill}>Sem complica√ß√£o</span>
        </div>
      </header>

      {/* COMPARA√á√ÉO */}
      <section className={styles.block}>
        <h2 className={styles.blockTitle}>Compare e escolha com clareza</h2>
        <div className={styles.compareWrap}>
          <table className={styles.compareTable}>
            <thead>
              <tr>
                <th>Recursos</th>
                <th>B√°sico</th>
                <th>PRO</th>
                <th>Premium</th>
              </tr>
            </thead>
            <tbody>
              {compare.map((row) => (
                <tr key={row.label}>
                  <td className={styles.compareLabel}>{row.label}</td>
                  <td><Check ok={row.basic} /></td>
                  <td><Check ok={row.pro} /></td>
                  <td><Check ok={row.premium} /></td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>

      {/* CARDS DE PLANOS */}
      <section className={styles.planosGrid}>
        <article className={`${styles.card} ${styles.planoBasico}`}>
          <h2 className="text-2xl font-extrabold m-0 text-slate-900">B√°sico</h2>
          <div className={styles.preco}>
            <span className={styles.valor}>29,90</span>
          </div>
          <ul className={styles.recursos}>
            {basic.map((item) => (<li key={item}>{item}</li>))}
          </ul>
          <Link href="/checkout/basico" className={`${styles.btn} ${styles.btnBasico}`}>
            Assinar B√°sico
          </Link>
        </article>

        <article className={`${styles.card} ${styles.planoPro}`}>
          <div className={styles.seloRecomendado}>RECOMENDADO</div>
          <h2 className="text-2xl font-extrabold m-0 text-slate-900">PRO</h2>
          <div className={styles.preco}>
            <span className={styles.valor}>49,90</span>
          </div>
          <ul className={styles.recursos}>
            {pro.map((item) => (<li key={item}>{item}</li>))}
          </ul>
          <Link href="/checkout/pro" className={`${styles.btn} ${styles.btnPro}`}>
            Assinar PRO
          </Link>
        </article>

        <article className={`${styles.card} ${styles.planoPremium}`}>
          <h2 className="text-2xl font-extrabold m-0 text-white">Premium</h2>
          <div className={styles.preco}>
            <span className={styles.valor}>99,90</span>
          </div>
          <ul className={styles.recursos}>
            {premium.map((item) => (<li key={item}>{item}</li>))}
          </ul>
          <Link href="/checkout/premium" className={`${styles.btn} ${styles.btnPremium}`}>
            Assinar Premium
          </Link>
        </article>
      </section>

      {/* FAQ */}
      <section className={styles.block}>
        <h2 className={styles.blockTitle}>D√∫vidas r√°pidas</h2>
        <div className={styles.faqGrid}>
          <details className={styles.faqItem}>
            <summary>Como funciona o acesso?</summary>
            <p>Voc√™ entra com CPF e telefone, recebe um c√≥digo por SMS e pronto.</p>
          </details>
          <details className={styles.faqItem}>
            <summary>Seja um profissional de elite. üõ°Ô∏è</summary>
            <p>Com o Plano PRO, voc√™ vai al√©m do √≥bvio. Tenha acesso exclusivo a guias de dire√ß√£o defensiva avan√ßada.</p>
          </details>
        </div>
      </section>
    </>
  );
}

export default function PlanosPage() {
  return (
    <main className={`${styles.rootVars} mx-auto max-w-7xl px-4 py-10`}>
      <Suspense fallback={<div className="text-center p-10">Carregando planos...</div>}>
        <PlanosContent />
      </Suspense>
    </main>
  );
}
